<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="MikroTik RouterOS Update Server Management Dashboard"
    />
    <title>MikroTik Update Server</title>
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>
    <!-- Sidebar Navigation -->
    <div class="sidebar">
      <div class="sidebar-header">
        <div>
          <div class="logo">üì¶ ROS Update</div>
          <p class="subtitle">Local Server</p>
        </div>
        <button
          id="themeToggle"
          type="button"
          class="icon-button"
          onclick="toggleTheme()"
          aria-label="Toggle theme"
        >
          <span class="theme-toggle-icon">üåô</span>
        </button>
      </div>

      <nav class="sidebar-nav">
        <a
          href="#"
          class="nav-link active"
          onclick="switchTab(event, 'dashboard')"
        >
          üìä Dashboard
        </a>
        <a href="#" class="nav-link" onclick="switchTab(event, 'versions')">
          üì¶ Versions
        </a>
        <a href="#" class="nav-link" onclick="switchTab(event, 'logs')">
          üìã Logs
        </a>
        <a href="#" class="nav-link" onclick="switchTab(event, 'schedule')">
          üìÖ Schedule
        </a>
        <a href="#" class="nav-link" onclick="switchTab(event, 'changelog')">
          üìù Changelog
        </a>
        <a href="#" class="nav-link" onclick="switchTab(event, 'config')">
          ‚öôÔ∏è Configuration
        </a>
      </nav>

      <div class="sidebar-footer">
        <p id="server-status" class="status-indicator">üî¥ Offline</p>
        <p class="version-text">v1.0.10–∞</p>
      </div>
    </div>

    <!-- Main Content Area -->
    <div class="main-content">
      <!-- Dashboard Tab -->
      <div id="dashboard" class="tab-pane active">
        <h2>üìä Dashboard</h2>

        <div class="grid-container">
          <!-- Quick Stats Card -->
          <div class="card">
            <div class="card-header">Quick Stats</div>
            <div class="card-content">
              <div class="grid-container">
                <div class="stat-box">
                  <div class="stat-number" id="cpuUsage">-</div>
                  <div class="stat-label">CPU Usage</div>
                </div>
                <div class="stat-box">
                  <div class="stat-number" id="memory">-</div>
                  <div class="stat-label">Memory</div>
                </div>
                <div class="stat-box">
                  <div class="stat-number" id="disk">-</div>
                  <div class="stat-label">Disk Used (GB)</div>
                </div>
                <div class="stat-box">
                  <div class="stat-number" id="total-gb">-</div>
                  <div class="stat-label">Total Downloaded (GB)</div>
                </div>
              </div>
            </div>
          </div>

          <!-- System Health Card -->
          <div class="card">
            <div class="card-header">System Health</div>
            <div class="card-content">
              <div class="status-item">
                <span class="status-label">Threads:</span>
                <span class="status-value" id="threads">-</span>
              </div>
              <div class="status-item">
                <span class="status-label">Uptime:</span>
                <span class="status-value" id="uptime">-</span>
              </div>
              <div class="status-item">
                <span class="status-label">Last Check:</span>
                <span class="status-value" id="last-check">-</span>
              </div>
              <div class="status-item">
                <span class="status-label">Total Files:</span>
                <span class="status-value" id="total-files">-</span>
              </div>
            </div>
          </div>

          <!-- Realtime Alerts Card -->
          <div class="card">
            <div class="card-header">Realtime Alerts</div>
            <div class="card-content">
              <div class="status-item">
                <span class="status-label">Disk Space:</span>
                <span class="status-value" id="alert-disk">OK</span>
              </div>
              <div class="status-item">
                <span class="status-label">Internet:</span>
                <span class="status-value" id="alert-internet">OK</span>
              </div>
              <div class="status-item">
                <span class="status-label">Background Jobs:</span>
                <span class="status-value" id="alert-jobs">OK</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Check Updates Section -->
        <div class="card">
          <div class="card-header">Update Check & Export</div>
          <div class="card-content">
            <div style="display: flex; gap: 10px; flex-wrap: wrap">
              <button class="btn btn-lg" onclick="checkUpdates(event)">
                ‚ü≥ Check Updates
              </button>
              <button
                class="btn btn-lg"
                style="background-color: var(--info)"
                onclick="exportDashboardData()"
              >
                üìä Export Data
              </button>
              <button
                class="btn btn-lg"
                style="background-color: var(--warning)"
                onclick="displayLogAnalytics()"
              >
                üìà Analytics
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Versions Tab -->
      <div id="versions" class="tab-pane">
        <h2>üì¶ Versions</h2>

        <div class="versions-overview">
          <div class="versions-grid">
            <div class="version-badge v6">
              <div class="badge-title">Active v6</div>
              <div class="badge-version" id="v6-active">-</div>
            </div>
            <div class="version-badge v7-fixed">
              <div class="badge-title">Active v7 (Fixed)</div>
              <div class="badge-version" id="v7-fixed">-</div>
            </div>
            <div class="version-badge v7-latest">
              <div class="badge-title">Latest v7</div>
              <div class="badge-version" id="v7-latest">-</div>
            </div>
          </div>
        </div>

        <div class="tabs-bar">
          <button
            class="tab-btn active"
            onclick="switchVersionTab(event, 'v6-tab')"
          >
            v6 Packages
          </button>
          <button class="tab-btn" onclick="switchVersionTab(event, 'v7-tab')">
            v7 Packages
          </button>
        </div>

        <div id="v6-tab" class="version-tab active">
          <table class="versions-table">
            <thead>
              <tr>
                <th>Version</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="v6-list">
              <tr>
                <td colspan="3" style="text-align: center; color: #999">
                  Loading...
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div id="v7-tab" class="version-tab">
          <table class="versions-table">
            <thead>
              <tr>
                <th>Version</th>
                <th>Type</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="v7-list">
              <tr>
                <td colspan="4" style="text-align: center; color: #999">
                  Loading...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Logs Tab -->
      <div id="logs" class="tab-pane">
        <h2>üìã Log Viewer</h2>

        <div class="logs-controls">
          <div class="filters-row">
            <div class="filter-group">
              <label>Level:</label>
              <select id="log-level" onchange="loadLogs()">
                <option value="">All Levels</option>
                <option value="Information">Information</option>
                <option value="Warning">Warning</option>
                <option value="Error">Error</option>
                <option value="Debug">Debug</option>
              </select>
            </div>

            <div class="filter-group">
              <label>Search:</label>
              <input
                type="text"
                id="log-search"
                placeholder="Search in logs..."
                oninput="debounceLoadLogs()"
              />
            </div>

            <div class="filter-group">
              <label>Show:</label>
              <select id="log-limit" onchange="loadLogs()">
                <option value="50">50 entries</option>
                <option value="100" selected>100 entries</option>
                <option value="200">200 entries</option>
                <option value="500">500 entries</option>
              </select>
            </div>
          </div>

          <div class="logs-actions">
            <button class="btn btn-primary" onclick="loadLogs()">
              üîÑ Refresh
            </button>
            <button class="btn btn-secondary" onclick="downloadLogs()">
              üì• Download Logs
            </button>
            <button class="btn btn-secondary" onclick="clearLogFilters()">
              üóëÔ∏è Clear Filters
            </button>
            <label class="auto-refresh">
              <input
                type="checkbox"
                id="auto-refresh"
                onchange="toggleAutoRefresh()"
              />
              Auto-refresh (10s)
            </label>
          </div>
        </div>

        <div class="logs-stats" id="logs-stats"></div>

        <div class="logs-container">
          <div class="logs-header">
            <span class="log-col timestamp">Timestamp</span>
            <span class="log-col level">Level</span>
            <span class="log-col source">Source</span>
            <span class="log-col message">Message</span>
          </div>
          <div class="logs-content" id="logs-content">
            <div class="log-entry">
              <span class="log-col timestamp">Loading...</span>
              <span class="log-col level"></span>
              <span class="log-col source"></span>
              <span class="log-col message"></span>
            </div>
          </div>
        </div>
      </div>

      <!-- Schedule Tab -->
      <div id="schedule" class="tab-pane">
        <h2>üìÖ Update Schedule</h2>

        <div class="schedule-status-card">
          <div class="status-header">
            <h3>Schedule Status</h3>
            <span class="status-badge" id="schedule-status-badge">
              Loading...
            </span>
          </div>
          <div class="status-details">
            <div class="status-item">
              <span class="status-label">Next Check:</span>
              <span class="status-value" id="next-check-time">-</span>
            </div>
            <div class="status-item">
              <span class="status-label">Time Until:</span>
              <span class="status-value" id="time-until-check">-</span>
            </div>
            <div class="status-item">
              <span class="status-label">Paused Until:</span>
              <span class="status-value" id="paused-until">-</span>
            </div>
          </div>
        </div>

        <div class="schedule-config">
          <h3>Configuration</h3>

          <form id="schedule-form">
            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" id="schedule-enabled" name="enabled" />
                Enable scheduled updates
              </label>
            </div>

            <div class="form-group">
              <label>Check Time:</label>
              <input
                type="time"
                id="check-time"
                name="checkTime"
                value="02:00"
              />
              <small>Server time when updates should be checked</small>
            </div>

            <div class="form-group">
              <label>Check Interval (minutes):</label>
              <input
                type="number"
                id="check-interval"
                name="intervalMinutes"
                value="60"
                min="10"
                max="1440"
              />
              <small>How often to check for updates (10‚Äì1440 minutes)</small>
            </div>

            <div class="form-group">
              <label>Days of Week:</label>
              <div class="days-selector">
                <label class="day-checkbox">
                  <input type="checkbox" name="days" value="Monday" checked />
                  Mon
                </label>
                <label class="day-checkbox">
                  <input type="checkbox" name="days" value="Tuesday" checked />
                  Tue
                </label>
                <label class="day-checkbox">
                  <input
                    type="checkbox"
                    name="days"
                    value="Wednesday"
                    checked
                  />
                  Wed
                </label>
                <label class="day-checkbox">
                  <input type="checkbox" name="days" value="Thursday" checked />
                  Thu
                </label>
                <label class="day-checkbox">
                  <input type="checkbox" name="days" value="Friday" checked />
                  Fri
                </label>
                <label class="day-checkbox">
                  <input type="checkbox" name="days" value="Saturday" checked />
                  Sat
                </label>
                <label class="day-checkbox">
                  <input type="checkbox" name="days" value="Sunday" checked />
                  Sun
                </label>
              </div>
            </div>

            <div class="form-group">
              <label>Notifications:</label>
              <label class="checkbox-label">
                <input
                  type="checkbox"
                  id="notify-completion"
                  name="notifyCompletion"
                />
                On completion
              </label>
              <label class="checkbox-label">
                <input type="checkbox" id="notify-errors" name="notifyErrors" />
                On errors
              </label>
            </div>

            <div class="form-group">
              <label>Pause Duration:</label>
              <select id="pause-duration" name="pauseDurationMinutes">
                <option value="60">1 hour</option>
                <option value="180">3 hours</option>
                <option value="360">6 hours</option>
                <option value="720">12 hours</option>
                <option value="1440">1 day</option>
              </select>
            </div>

            <div class="form-actions">
              <button type="submit" class="btn btn-primary">
                üíæ Save Schedule
              </button>
              <button
                type="button"
                class="btn btn-secondary"
                onclick="pauseSchedule()"
              >
                ‚∏∏ Pause
              </button>
              <button
                type="button"
                class="btn btn-success"
                onclick="resumeSchedule()"
              >
                ‚ñ∂Ô∏è Resume
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Changelog Tab -->
      <div id="changelog" class="tab-pane">
        <h2>üìù Changelog</h2>

        <div class="tabs-bar">
          <button
            class="tab-btn active"
            onclick="switchChangelogTab(event, 'global-changelog')"
          >
            üìã Global
          </button>
          <button
            class="tab-btn"
            onclick="switchChangelogTab(event, 'version-changelog')"
          >
            üìÑ Version Specific
          </button>
          <button
            class="tab-btn"
            onclick="switchChangelogTab(event, 'history')"
          >
            üìö History
          </button>
        </div>

        <!-- Global Changelog -->
        <div id="global-changelog" class="changelog-tab active">
          <div class="changelog-container">
            <div class="changelog-header">
              <h3>Global Changelog</h3>
              <button
                type="button"
                class="btn btn-sm btn-primary"
                onclick="loadGlobalChangelog()"
              >
                üîÑ Refresh
              </button>
            </div>
            <div id="global-changelog-content" class="changelog-content">
              <p style="color: #999">Loading...</p>
            </div>
          </div>
        </div>

        <!-- Version Specific Changelog -->
        <div id="version-changelog" class="changelog-tab">
          <div class="changelog-container">
            <div class="changelog-header">
              <h3>Changelog for Specific Version</h3>
              <div
                style="
                  display: flex;
                  gap: 10px;
                  align-items: center;
                  flex-wrap: wrap;
                "
              >
                <select id="version-select" class="form-select">
                  <option value="">Select a version...</option>
                </select>
                <button
                  type="button"
                  class="btn btn-sm btn-primary"
                  onclick="loadVersionChangelog()"
                >
                  üîÑ Load
                </button>
              </div>
            </div>
            <div id="version-changelog-content" class="changelog-content">
              <p style="color: #999">Select a version to view its changelog</p>
            </div>
          </div>
        </div>

        <!-- History -->
        <div id="history" class="changelog-tab">
          <div class="changelog-container">
            <div class="changelog-header">
              <h3>Version History</h3>
              <button
                type="button"
                class="btn btn-sm btn-primary"
                onclick="loadVersionHistory()"
              >
                üîÑ Refresh
              </button>
            </div>
            <div class="changelog-content">
              <table class="versions-table">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>v6 Stable</th>
                    <th>v7 Fixed</th>
                    <th>v7 Stable</th>
                  </tr>
                </thead>
                <tbody id="history-list">
                  <tr>
                    <td colspan="4" style="text-align: center; color: #999">
                      Loading...
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Configuration Tab -->
      <div id="config" class="tab-pane">
        <h2>‚öôÔ∏è Configuration</h2>

        <div class="config-section">
          <h3>Allowed RouterOS Architectures</h3>
          <p>
            Select which MikroTik RouterOS architectures should be downloaded
            and stored by this server.
          </p>

          <div class="checkbox-grid" id="arches-container">
            <label class="checkbox-label">
              <input type="checkbox" value="arm" /> arm
            </label>
            <label class="checkbox-label">
              <input type="checkbox" value="arm64" /> arm64
            </label>
            <label class="checkbox-label">
              <input type="checkbox" value="mipsbe" /> mipsbe
            </label>
            <label class="checkbox-label">
              <input type="checkbox" value="mmips" /> mmips
            </label>
            <label class="checkbox-label">
              <input type="checkbox" value="smips" /> smips
            </label>
            <label class="checkbox-label">
              <input type="checkbox" value="tile" /> tile
            </label>
            <label class="checkbox-label">
              <input type="checkbox" value="ppc" /> ppc
            </label>
          </div>
          <div class="form-actions" style="margin-top: 10px">
            <button
              type="button"
              class="btn btn-primary"
              onclick="saveAllowedArches()"
            >
              üíæ Save Architectures
            </button>
            <span id="arches-status" style="margin-left: 10px; font-size: 12px">
            </span>
          </div>
        </div>

        <div class="config-section">
          <h3>Server Settings</h3>
          <p>
            Select the time zone for the schedule and logs to work correctly.
          </p>

          <div class="form-group">
            <label for="tzSelect">Time zone:</label>
            <select id="tzSelect" class="form-select"></select>
          </div>

          <div class="form-actions" style="margin-top: 10px">
            <button
              type="button"
              class="btn btn-primary"
              onclick="saveTimeZone()"
            >
              üíæ Save Time Zone
            </button>
            <small
              id="tzStatus"
              style="margin-left: 10px; font-size: 12px"
            ></small>
          </div>
        </div>

        <div class="config-section">
          <h3>File Prefixes to Delete</h3>
          <p>
            Each prefix on a new line. Extra files matching these prefixes will
            be deleted from v6 archives.
          </p>
          <textarea
            id="delete-prefixes-input"
            class="config-textarea"
            rows="3"
            placeholder="advanced-tools-&#10;wireless-&#10;dude-"
          ></textarea>

          <div class="form-actions" style="margin-top: 10px">
            <button
              type="button"
              class="btn btn-primary"
              onclick="saveDeletePrefixes()"
            >
              üíæ Save Prefixes
            </button>
            <span
              id="delete-prefixes-status"
              style="margin-left: 10px; font-size: 12px"
            ></span>
          </div>
        </div>

        <div class="config-section">
          <h3>Setup on MikroTik</h3>
          <p>Add DNS static entry:</p>
          <div class="code-block">
            <code
              >/ip dns static add name="upgrade.mikrotik.com"
              address=YOUR_IP</code
            >
          </div>
          <p>Check for updates:</p>
          <div class="code-block">
            <code>/system package update check-for-updates</code>
          </div>
          <p>Install:</p>
          <div class="code-block">
            <code>/system package update install</code>
          </div>
        </div>
      </div>
    </div>

    <script src="/app.js"></script>
  </body>
</html>
